(e=>{let t,l=()=>{e.querySelector("aside#mask").dataset.state="visible"},r=()=>{e.querySelector("aside#mask").dataset.state="hidden"};!function(e){e[e.SUVIVOR=0]="SUVIVOR",e[e.ALONE=1]="ALONE",e[e.BIRTH=2]="BIRTH",e[e.DEAD=3]="DEAD",e[e.EXTINCT=4]="EXTINCT"}(t||(t={}));let a=(l,r,a)=>{let o,n=e.querySelector("#generation").innerHTML;switch(l){case t.SUVIVOR:o=e.createTextNode("【決着】"+a+" 家が第 "+n+" 世代で名字を統一しました");break;case t.BIRTH:o=e.createTextNode("["+n+"] "+a+" さん出産を報告");break;case t.EXTINCT:o=e.createTextNode("["+n+"] "+a+" 家が断絶");break;case t.ALONE:case t.DEAD:default:return}let i=e.createElement("dd");i.appendChild(o),i.dataset.id=r,i.dataset.mode=l+"",e.querySelector("section#table dl").insertBefore(i,e.querySelector("section#table dl").firstChild)},o=()=>{l(),setTimeout((()=>{var l,n,i,d;if(Array.from(new Map(Array.from(e.querySelectorAll("section#table ol li")).map((e=>[e.dataset.id,0])))).length<2){let o=(null===(l=e.querySelector("section#table ol li"))||void 0===l?void 0:l.dataset.id)+"",i=(null===(n=e.querySelector('#table ul li[data-id="'+o+'"] span'))||void 0===n?void 0:n.innerHTML)+"";if(a(t.SUVIVOR,o,i),e.querySelectorAll('#table dl dd[data-mode="3"]').length){let t=0;for(let l=0,r=e.querySelectorAll("#table dl dd"),a=r.length;l<a&&r[l]!==Array.from(e.querySelectorAll('#table dl dd[data-mode="3"]')).pop();l++)t++;e.querySelectorAll("#table dd:nth-of-type(n+"+(t+3)+")").forEach((e=>{e.innerHTML=e.innerHTML.replace(" 家が断絶","家")}))}else e.querySelectorAll("#table dl dd:not(:nth-of-type(-n+3))").forEach((e=>{e.innerHTML=e.innerHTML.replace(" 家が断絶","家")}));return e.querySelector("main").dataset.state="pause",void r()}if("pausing"===e.querySelector("main").dataset.state)return e.querySelector("main").dataset.state="pause",void r();if(e.querySelector("main").dataset.state="playing",e.querySelectorAll("section#table ol li").length%2==1){let l=(null===(i=e.querySelector("section#table ol li:last-of-type"))||void 0===i?void 0:i.dataset.id)+"",r=(null===(d=e.querySelector('#table ul li[data-id="'+l+'"] span'))||void 0===d?void 0:d.innerHTML)+"";a(t.ALONE,l,r);let o=e.querySelector("section#table ol").getElementsByTagName("li").length-1;e.querySelector("section#table ol").removeChild(e.querySelector("section#table ol").getElementsByTagName("li")[o])}let c=[];Array.from(e.querySelectorAll("section#table ol li")).sort((()=>~~(3*Math.random())-1)).forEach((e=>{c.push(e)}));let u=[],s=[];for(let e=0,t=c.length;e<t;e+=2){let t="",l="";~~(2*Math.random())-0?(t=c[e].dataset.id+"",l=c[e].style.backgroundColor):(t=c[e+1].dataset.id+"",l=c[e+1].style.backgroundColor),c[e].dataset.id=t,c[e].style.backgroundColor=l,c[e+1]&&(c[e+1].dataset.id=t,c[e+1].style.backgroundColor=l),100*Math.random()<=.0315&&u.push({id:t,color:l}),100*Math.random()<=.129&&s.push({elm:c[e],id:t}),100*Math.random()<=.129&&s.push({elm:c[e+1],id:t})}u.forEach((l=>{var r;let o=e.createElement("li");o.dataset.id=l.id,o.style.backgroundColor=l.color,c.push(o),e.querySelector("section#table ol").appendChild(o);let n=(null===(r=e.querySelector('#table ul li[data-id="'+l.id+'"] span'))||void 0===r?void 0:r.innerHTML)+"";a(t.BIRTH,l.id,n)})),s.forEach((l=>{var r;c.splice(1),e.querySelector("section#table ol").removeChild(l.elm);let o=(null===(r=e.querySelector('#table ul li[data-id="'+l.id+'"] span'))||void 0===r?void 0:r.innerHTML)+"";a(t.DEAD,l.id,o)}));let y=Array.from(new Map(Array.from(e.querySelectorAll("section#table ol li")).map((e=>[e.dataset.id,0]))).keys()).sort();Array.from(e.querySelectorAll("section#table ul li")).filter((e=>"0"!==e.querySelector("small").innerHTML)).map((e=>e.dataset.id)).sort().filter((e=>!y.includes(e))).forEach((l=>{var r;let o=(null===(r=e.querySelector('#table ul li[data-id="'+l+'"] span'))||void 0===r?void 0:r.innerHTML)+"";a(t.EXTINCT,l+"",o)}));let p=0,m=0;e.querySelectorAll("#table ul li").forEach((t=>{let l=e.querySelectorAll('section#table ol li[data-id="'+t.dataset.id+'"]').length;t.querySelector("small").innerHTML=l+"",t.dataset.tmpcnt=l+"",l>p&&(p=l),m+=l})),e.querySelectorAll("#table ul li").forEach((e=>{let t=~~(parseInt(e.dataset.tmpcnt+"")/p*100);e.querySelector("meter").value=t,e.style.order=p-parseInt(e.dataset.tmpcnt+"")+"",e.removeAttribute("data-tmpcnt")}));let S=e.querySelector("section#table ul");e.querySelectorAll("#table ul li").forEach((e=>{"0"===e.querySelector("small").innerHTML.toString()&&(e.removeChild(e.querySelector("data")),e.removeChild(e.querySelector("span")),e.removeChild(e.querySelector("small")),e.removeChild(e.querySelector("meter")),S.removeChild(e))})),S=null,S=e.querySelector("section#table dl");for(let t=e.querySelectorAll('section#table dd[data-mode="3"]').length-20;t>0;t--)S.removeChild(Array.from(S.querySelectorAll('dd[data-mode="3"]')).pop());S=null;let h=parseInt(e.querySelector("#generation").innerHTML);e.querySelector("#generation").innerHTML=(isNaN(h)?0:h)+1+"",e.querySelector("#population").innerHTML=m+"","playing"===e.querySelector("main").dataset.state&&setTimeout((()=>{o()}),150),r()}),10)},n=()=>{e.querySelector("main").dataset.state="pausing"},i=()=>{l(),setTimeout((()=>{let t=e.querySelector("section#data textarea").value;if(!t)return r(),void alert("ERR_100: データが存在しません");let l=t.replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/\n+/g,"\n").replace(/(^\n|\n$)/,"");if(!l)return r(),void alert("ERR_101: データが存在しません");let a=l.split("\n").map((e=>e.split("\t")));for(let e=0,t=a.length;e<t;e++){if(2!==a[e].length)return r(),void alert("ERR_110: データの書式が正しくありません");if(""===a[e][0])return r(),void alert("ERR_111: データの名字が空欄です");if(""===a[e][1])return r(),void alert("ERR_112: データの件数が空欄です");if(/[^0-9]/.test(a[e][1]+""))return r(),void alert("ERR_113: データの件数に数字以外の文字が含まれています");a[e][0]=a[e][0]+"",a[e][1]=~~a[e][1],a[e][2]=e}let o=[],n=0;for(let e=0,t=a.length;e<t;e++)n<parseInt(a[e][1]+"")&&(n=parseInt(a[e][1]+"")),o.push({id:parseInt(a[e][2]+""),name:a[e][0]+"",count:parseInt(a[e][1]+""),color:"#"+(~~(255*Math.random())).toString(16).padStart(4,"0").substring(2,4)+(~~(255*Math.random())).toString(16).padStart(4,"0").substring(2,4)+(~~(255*Math.random())).toString(16).padStart(4,"0").substring(2,4)});let i=[];for(let e=0,t=a.length;e<t;e++)for(let t=0,l=parseInt(a[e][1]+"");t<l;t++)i.push({id:parseInt(a[e][2].toString()),name:parseInt(a[e][0].toString()),value:~~(1e9*Math.random())});i.sort(((e,t)=>e.value-t.value)),0!==e.querySelectorAll("section#table ol li").length&&e.querySelectorAll("section#table ol li").forEach((e=>{var t;null===(t=e.parentNode)||void 0===t||t.removeChild(e)})),0!==e.querySelectorAll("section#table dl dd").length&&e.querySelectorAll("section#table dl dd").forEach((e=>{var t;null===(t=e.parentNode)||void 0===t||t.removeChild(e)})),0!==e.querySelectorAll("section#table ul li").length&&e.querySelectorAll("section#table ul li").forEach((e=>{var t;null===(t=e.parentNode)||void 0===t||t.removeChild(e)}));let d=e.querySelector("section#table ol");i.forEach((t=>{let l=e.createElement("li");d.appendChild(l),l.setAttribute("data-id",t.id+"");let r=o.filter((e=>e.id===t.id));0===r.length?l.style.backgroundColor="#0000":l.style.backgroundColor=r[0].color})),d=null,d=e.querySelector("section#table ul"),o.forEach((t=>{let l=e.createElement("li"),r=e.createElement("data"),a=e.createElement("span"),o=e.createTextNode(t.name),i=e.createElement("small"),c=e.createTextNode(t.count+""),u=e.createElement("meter"),s=~~(t.count/n*100);d.appendChild(l),l.appendChild(r),l.appendChild(a),a.appendChild(o),l.appendChild(i),i.appendChild(c),l.appendChild(u),l.setAttribute("data-id",t.id+""),r.style.backgroundColor=t.color,u.setAttribute("value",s+""),u.setAttribute("min","0"),u.setAttribute("max","100"),u.setAttribute("low","0"),u.setAttribute("high","50"),u.setAttribute("optimum","50")})),d=null,e.querySelector("b#generation").innerHTML="1";let c=0;e.querySelectorAll("#table ul li").forEach((t=>{let l=e.querySelectorAll('section#table ol li[data-id="'+t.dataset.id+'"]').length;c+=l})),e.querySelector("#population").innerHTML=c+"",r()}),10)};e.addEventListener("DOMContentLoaded",(()=>{var t,l,r,a,d,c;null===(t=e.querySelector("button#start"))||void 0===t||t.addEventListener("click",o),null===(l=e.querySelector("button#stop"))||void 0===l||l.addEventListener("click",n),null===(r=e.querySelector("button#init"))||void 0===r||r.addEventListener("click",i),null===(a=e.querySelector("button#start"))||void 0===a||a.addEventListener("click",(()=>{gtag("event","click_start")})),null===(d=e.querySelector("button#stop"))||void 0===d||d.addEventListener("click",(()=>{gtag("event","click_stop")})),null===(c=e.querySelector("button#init"))||void 0===c||c.addEventListener("click",(()=>{gtag("event","click_init")}));let u=e.querySelector("head"),s=e.createElement("link");null==u||u.appendChild(s),s.rel="stylesheet",s.href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@500&display=swap"}))})(document);