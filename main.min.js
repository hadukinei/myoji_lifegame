(()=>{let e=()=>{document.querySelector("aside#mask").dataset.state="visible"},t=()=>{document.querySelector("aside#mask").dataset.state="hidden"};const o=1,r=2,a=3,n=4,d=5;let c=(e,t,l)=>{let r,n=document.createElement("dd"),i=document.querySelector("#generation").innerHTML;switch(e){case o:r=document.createTextNode("【決着】"+l+" 家が第 "+i+" 世代で名字を統一しました");break;case a:r=document.createTextNode("["+i+"] "+l+" さん出産を報告");break;case d:r=document.createTextNode("["+i+"] "+l+" 家が断絶");break;default:return void(n=null)}n.appendChild(r),n.dataset.id=t,n.dataset.mode=e,document.querySelector("section#table dl").insertBefore(n,document.querySelector("section#table dl").firstChild),n=null},u=()=>{e(),setTimeout((()=>{if(Array.from(new Map(Array.from(document.querySelectorAll("section#table ol li")).map((e=>[e.dataset.id,0])))).length<2){let e=document.querySelector("section#table ol li").dataset.id,l=document.querySelector('#table ul li[data-id="'+e+'"] span').innerHTML;return c(o,e,l),document.querySelector("main").dataset.state="pause",void t()}if("pausing"===document.querySelector("main").dataset.state)return document.querySelector("main").dataset.state="pause",void t();if(document.querySelector("main").dataset.state="playing",document.querySelectorAll("section#table ol li").length%2==1){let e=document.querySelector("section#table ol li:last-of-type").dataset.id,t=document.querySelector('#table ul li[data-id="'+e+'"] span').innerHTML;c(r,e,t),document.querySelector("section#table ol").removeChild(document.querySelector("section#table ol li:last-of-type"))}let e=[];Array.from(document.querySelectorAll("section#table ol li")).sort((()=>~~(3*Math.random())-1)).forEach((t=>{e.push(t)}));let l=[],i=[];for(let t=0,o=e.length;t<o;t+=2){let o=0,r="";~~(2*Math.random())-0?(o=e[t].dataset.id,r=e[t].style.backgroundColor):(o=e[t+1].dataset.id,r=e[t+1].style.backgroundColor),e[t].dataset.id=o,e[t].style.backgroundColor=r,e[t+1]&&(e[t+1].dataset.id=o,e[t+1].style.backgroundColor=r),100*Math.random()<=.0315&&l.push({id:o,color:r}),100*Math.random()<=.129&&i.push({elm:e[t],id:o}),100*Math.random()<=.129&&i.push({elm:e[t+1],id:o})}l.forEach((t=>{let l=document.createElement("li");l.dataset.id=t.id,l.style.backgroundColor=t.color,e.push(l),document.querySelector("section#table ol").appendChild(l);let o=document.querySelector('#table ul li[data-id="'+t.id+'"] span').innerHTML;c(a,t.id,o),l=null})),i.forEach((t=>{e.splice(1),document.querySelector("section#table ol").removeChild(t.elm),t.elm=null;let l=document.querySelector('#table ul li[data-id="'+t.id+'"] span').innerHTML;c(n,t.id,l),li=null}));let s=Array.from(new Map(Array.from(document.querySelectorAll("section#table ol li")).map((e=>[e.dataset.id,0]))).keys()).sort();Array.from(document.querySelectorAll("section#table ul li")).filter((e=>"0"!==e.querySelector("small").innerHTML)).map((e=>e.dataset.id)).sort().filter((e=>!s.includes(e))).forEach((e=>{let t=document.querySelector('#table ul li[data-id="'+e+'"] span').innerHTML;c(d,e,t)})),e=null;let m=0,y=0;document.querySelectorAll("#table ul li").forEach((e=>{let t=document.querySelectorAll('section#table ol li[data-id="'+e.dataset.id+'"]').length;e.querySelector("small").innerHTML=t+"",e.dataset.tmpcnt=t+"",t>m&&(m=t),y+=t})),document.querySelectorAll("#table ul li").forEach((e=>{let t=~~((e.dataset.tmpcnt-0)/m*100);e.querySelector("meter").value=t+"",e.style.order=m-(e.dataset.tmpcnt-0)+"",e.removeAttribute("data-tmpcnt")}));let p=document.querySelector("#generation").innerHTML-0;document.querySelector("#generation").innerHTML=p+1+"",document.querySelector("#population").innerHTML=y+"","playing"===document.querySelector("main").dataset.state&&setTimeout((()=>{u()}),500),t()}),10)},s=()=>{document.querySelector("main").dataset.state="pausing"},m=()=>{e(),setTimeout((()=>{let e=document.querySelector("section#data textarea").value;if(!e)return t(),void alert("ERR_100: データが存在しません");let o=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/\n+/g,"\n").replace(/(^\n|\n$)/,"");if(!o)return t(),void alert("ERR_101: データが存在しません");o=o.split("\n");for(let e=0,l=o.length;e<l;e++){if(o[e]=o[e].split("\t"),2!==o[e].length)return t(),void alert("ERR_110: データの書式が正しくありません");if(""===o[e][0])return t(),void alert("ERR_111: データの名字が空欄です");if(""===o[e][1])return t(),void alert("ERR_112: データの件数が空欄です");if(/[^0-9]/.test(o[e][1]))return t(),void alert("ERR_113: データの件数に数字以外の文字が含まれています");o[e][0]=o[e][0]+"",o[e][1]=~~o[e][1],o[e][2]=e}let r=[],a=0;for(i=0,l=o.length;i<l;i++)a<o[i][1]&&(a=o[i][1]),r.push({id:o[i][2],name:o[i][0],count:o[i][1],color:"#"+(~~(255*Math.random())).toString(16).padStart(4,"0").substring(2,4)+(~~(255*Math.random())).toString(16).padStart(4,"0").substring(2,4)+(~~(255*Math.random())).toString(16).padStart(4,"0").substring(2,4)});let n=[];for(i=0,l=o.length;i<l;i++)for(let e=0,t=o[i][1];e<t;e++)n.push({id:o[i][2],name:o[i][0],value:~~(1e9*Math.random())});n.sort(((e,t)=>e.value-t.value)),0!==document.querySelectorAll("section#table ol li").length&&document.querySelectorAll("section#table ol li").forEach((e=>{e.parentNode.removeChild(e)})),0!==document.querySelectorAll("section#table dl dd").length&&document.querySelectorAll("section#table dl dd").forEach((e=>{e.parentNode.removeChild(e)})),0!==document.querySelectorAll("section#table ul li").length&&document.querySelectorAll("section#table ul li").forEach((e=>{e.parentNode.removeChild(e)}));let d=document.querySelector("section#table ol");n.forEach((e=>{let t=document.createElement("li");d.appendChild(t),t.setAttribute("data-id",e.id);let l=r.filter((t=>t.id===e.id));0===l.length?t.style.backgroundColor="#0000":t.style.backgroundColor=l[0].color,t=null})),d=null,d=document.querySelector("section#table ul"),r.forEach((e=>{let t=document.createElement("li"),l=document.createElement("data"),o=document.createElement("span"),r=document.createTextNode(e.name),n=document.createElement("small"),i=document.createTextNode(e.count),c=document.createElement("meter"),u=~~(e.count/a*100);d.appendChild(t),t.appendChild(l),t.appendChild(o),o.appendChild(r),t.appendChild(n),n.appendChild(i),t.appendChild(c),t.setAttribute("data-id",e.id),l.style.backgroundColor=e.color,c.setAttribute("value",u),c.setAttribute("min",0),c.setAttribute("max",100),c.setAttribute("low",0),c.setAttribute("high",50),c.setAttribute("optimum",50),t=l=o=r=n=i=c=null})),d=null,document.querySelector("b#generation").innerHTML="1";let c=0;document.querySelectorAll("#table ul li").forEach((e=>{let t=document.querySelectorAll('section#table ol li[data-id="'+e.dataset.id+'"]').length;c+=t})),document.querySelector("#population").innerHTML=c+"",t()}),10)};document.addEventListener("DOMContentLoaded",(()=>{document.querySelector("button#start").addEventListener("click",u),document.querySelector("button#stop").addEventListener("click",s),document.querySelector("button#init").addEventListener("click",m);let e=document.querySelector("head"),t=document.createElement("link");e.appendChild(t),t.rel="stylesheet",t.href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@500&display=swap"}))})();